<!DOCTYPE html>
<html>
    <head>
    <title>C's Blog</title>
    <style>
        body {
        font-family: Arial, sans-serif;
        }

        header {
        background-color: rgb(237, 201, 249);
        color: rgb(126, 58, 9);
        padding: 20px;
        }

        h1 {
        margin: 0;
        }

        .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        border: 1px solid #ccc;
        }

        .blog-form input[type="text"],
        .blog-form textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        }

        .blog-form button {
        padding: 10px 20px;
        background-color: rgb(126, 58, 9);
        color: #fff;
        border: none;
        cursor: pointer;
        }

        .blog-list {
        list-style-type: none;
        padding: 0;
        }

        .blog-item {
        margin-bottom: 20px;
        border: 1px solid #ccc;
        padding: 10px;
        }

        .edit-form input[type="text"],
        .edit-form textarea {
        width: 100%;
        padding: 5px;
        margin-bottom: 5px;
        }

        .edit-form button {
        padding: 5px 10px;
        background-color: #333;
        color: #fff;
        border: none;
        cursor: pointer;
        }
    </style>
    </head>
    <body>
    <header>
        <h1>Let's Blog!</h1>
    </header>

    <div class="container">
        <h2>Create a new blog post:</h2>
        <form class="blog-form">
        <input type="text" name="title" placeholder="Enter title" required>
        <textarea name="content" placeholder="Enter content" required></textarea>
        <button type="submit">Submit</button>
        </form>

        <h2>All Blog Posts:</h2>
        <ul class="blog-list"></ul>
    </div>

    <script>
        const API_URL = 'https://sistech-api.vercel.app/blog';
        const blogForm = document.querySelector('.blog-form');
        const blogList = document.querySelector('.blog-list');
    
        // Function to fetch all blog posts
        async function fetchBlogs() {
          try {
            const response = await fetch('https://sistech-api.vercel.app/',
              {
                  "name": "ical",
                  "token": "e5fe227b-a6b1-4185-acd4-d6898005ee98"
              }
              );
            const blogs = await response.json();
    
            // Clear existing blog posts
            blogList.innerHTML = '';
    
            // Add fetched blog posts to the list
            blogs.forEach(blog => {
              const listItem = document.createElement('li');
              listItem.classList.add('blog-item');
              listItem.innerHTML = `
                <h3>${blog.title}</h3>
                <p>${blog.content}</p>
                <button class="edit-btn" data-id="${blog.id}">Edit</button>
              `;
    
              blogList.appendChild(listItem);
            });
          } catch (error) {
            console.error('Error fetching blogs:', error);
          }
        }
    
        // Function to create a new blog post
        async function createBlog(title, content) {
          try {
            const response = await fetch("https://sistech-api.vercel.app/blog", {
              method: "POST",
              headers: {
                  "Authorization": "Bearer e5fe227b-a6b1-4185-acd4-d6898005ee98",
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                title: title,
                content: content,
                owner: "e5fe227b-a6b1-4185-acd4-d6898005ee98"
              })
            });
            
            if (response.ok) {
              fetchBlogs();
              blogForm.reset();
            } else {
              console.error('Failed to create blog:', response.statusText);
            }
          } catch (error) {
            console.error('Error creating blog:', error);
          }
        }
    
        // Function to update a blog post
        async function updateBlog(id, title, content) {
          try {
            const response = await fetch(`https://sistech-api.vercel.app/blog`, {
              method: "PUT",
              headers: {
                "Authorization": "Bearer e5fe227b-a6b1-4185-acd4-d6898005ee98",
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                title: newTitle,
                content: newContent,
                id: newEntry.id
              })
            });
            if (response.ok) {
              fetchBlogs();
            } else {
              console.error('Failed to update blog:', response.statusText);
            }
          } catch (error) {
            console.error('Error updating blog:', error);
          }
        }
    
        // Event listener for form submission
        blogForm.addEventListener('submit', function(event) {
          event.preventDefault();
    
          const title = blogForm.querySelector('input[name="title"]').value;
          const content = blogForm.querySelector('textarea[name="content"]').value;
    
          createBlog(title, content);
        });
    
        // Event listener for edit button click
        blogList.addEventListener('click', function(event) {
          if (event.target.classList.contains('edit-btn')) {
            const listItem = event.target.parentNode;
            const id = event.target.getAttribute('data-id');
            const title = listItem.querySelector('h3').textContent;
            const content = listItem.querySelector('p').textContent;
    
            const editForm = document.createElement('form');
            editForm.classList.add('edit-form');
            editForm.innerHTML = `
              <input type="text" name="title" value="${title}" required>
              <textarea name="content" required>${content}</textarea>
              <button type="submit">Save</button>
            `;
    
            editForm.addEventListener('submit', function(event) {
              event.preventDefault();
    
              const updatedTitle = editForm.querySelector('input[name="title"]').value;
              const updatedContent = editForm.querySelector('textarea[name="content"]').value;
    
              updateBlog(id, updatedTitle, updatedContent);
            });
    
            listItem.outerHTML = '';
            listItem.appendChild(editForm);
          }
        });
    
        // Fetch initial blog posts on page load
        fetchBlogs();
      </script>
    </body>
</html>
